<!DOCTYPE html>
<html>
  <head>
    <title>Cookie FE 2 - tower</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <div id="cookie">home.company2.eu:</div>
    <iframe
      src="https://home.company.eu/tower3.html"
      width="700"
      height="380"
    ></iframe>
    <script type="text/javascript">
      window.addEventListener("message", function (event) {
        if (event.origin != "https://home.company.eu") {
          console.error(`2 - Origin ${event.origin} not allowed`);
          return;
        }
        console.log("2", event.data);
        event.source.postMessage(`Message received: ${event.data}`, event.origin);
        // can message back using event.source.postMessage(...)
      });
      window.parent.postMessage('I am alive', 'https://home.company.eu');

      fetch("https://api.home.company.eu/cookies/tower2", {
        method: "GET",
        credentials: "include",
      }).then((v) =>
        v.json().then((payload) => {
          const div = document.createElement("div");
          div.appendChild(document.createTextNode(JSON.stringify(payload)));
          document.getElementById("cookie").appendChild(div);

          try {
            const div2 = document.createElement("div");
            div2.appendChild(
              document.createTextNode(
                `localStorage: ${localStorage.getItem("test1")}`
              )
            );
            document.getElementById("cookie").appendChild(div2);
          } catch (e) {
            console.error("2", e);
          }

          try {
            const div2 = document.createElement("div");
            div2.appendChild(
              document.createTextNode(
                `sessionStorage: ${sessionStorage.getItem("test2")}`
              )
            );
            document.getElementById("cookie").appendChild(div2);
          } catch (e) {
            console.error("2", e);
          }
        })
      );
    </script>
  </body>
</html>
