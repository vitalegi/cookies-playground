<!DOCTYPE html>
<html>
  <head>
    <title>Cookie FE 1 - tower</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <div id="cookie">home.company.eu:</div>
    <iframe
      src="https://home.company2.eu/tower2.html"
      width="750"
      height="440"
      name="tower2"
    ></iframe>
    <script type="text/javascript">
      window.addEventListener("message", function (event) {
        if (event.origin != "https://home.company2.eu") {
          console.error(`Origin ${event.origin} not allowed`);
          return;
        }
        console.log(event.data);
      });

      fetch("https://api.home.company.eu/cookies/tower1", {
        method: "GET",
        credentials: "include",
      }).then((v) =>
        v.json().then((payload) => {
          const div = document.createElement("div");
          div.appendChild(document.createTextNode(JSON.stringify(payload)));
          document.getElementById("cookie").appendChild(div);

          try {
            const div2 = document.createElement("div");
            div2.appendChild(
              document.createTextNode(
                `localStorage: ${localStorage.getItem("test1")}`
              )
            );
            document.getElementById("cookie").appendChild(div2);
          } catch (e) {
            console.error(e);
          }

          try {
            const div2 = document.createElement("div");
            div2.appendChild(
              document.createTextNode(
                `sessionStorage: ${sessionStorage.getItem("test2")}`
              )
            );
            document.getElementById("cookie").appendChild(div2);
          } catch (e) {
            console.error(e);
          }

          setInterval(() => {
            window.frames.tower2.postMessage(
              JSON.stringify(payload),
              "https://home.company2.eu"
            );
          }, 1000);
        })
      );
    </script>
  </body>
</html>
